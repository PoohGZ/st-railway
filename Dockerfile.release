FROM ghcr.io/sillytavern/sillytavern:1.12.11

# So that we only need one volume
RUN mkdir ./persist

RUN sed -i 's/OPENROUTER_PROVIDERS = \[/OPENROUTER_PROVIDERS = \[\n    "Chutes",/' ./public/scripts/textgen-models.js

# Move all the necessary directories for later
RUN \
  mv ./config ./_config || mkdir ./_config && \
  mv ./data ./_data || mkdir ./_data && \
  mv ./plugins ./_plugins || mkdir ./_plugins && \
  ln -sf ./persist/config ./config && \
  ln -sf ./persist/data ./data && \
  ln -sf ./persist/plugins ./plugins

COPY entrypoint.sh ./

RUN chmod +x ./entrypoint.sh

CMD ["./entrypoint.sh"]
